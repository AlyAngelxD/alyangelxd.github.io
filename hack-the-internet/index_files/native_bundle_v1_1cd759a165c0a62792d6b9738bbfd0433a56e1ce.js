/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! matches.js v1.0.3 - Nicolas Gallagher - MIT license */

/*! delegate.js v1.0.2 - Nicolas Gallagher - MIT license */

/*!
 * xdm.js – Nicolas Gallagher – MIT License
 * easyXDM – Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no – MIT License
 */

!function(){var e,t,n;!function(o){function r(e,t){return T.call(e,t)}function a(e,t){var n,o,r,a,i,c,s,l,u,d,p=t&&t.split("/"),f=E.map,m=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),l=0;l<e.length;l+=1)if(d=e[l],"."===d)e.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||m)&&f){for(n=e.split("/"),l=n.length;l>0;l-=1){if(o=n.slice(0,l).join("/"),p)for(u=p.length;u>0;u-=1)if(r=f[p.slice(0,u).join("/")],r&&(r=r[o])){a=r,i=l;break}if(a)break;!c&&m&&m[o]&&(c=m[o],s=l)}!a&&c&&(a=c,i=s),a&&(n.splice(0,i,a),e=n.join("/"))}return e}function i(e,t){return function(){return f.apply(o,D.call(arguments,0).concat([e,t]))}}function c(e){return function(t){return a(t,e)}}function s(e){return function(t){g[e]=t}}function l(e){if(r(h,e)){var t=h[e];delete h[e],v[e]=!0,p.apply(o,t)}if(!r(g,e)&&!r(v,e))throw new Error("No "+e);return g[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return E&&E.config&&E.config[e]||{}}}var p,f,m,_,g={},h={},E={},v={},T=Object.prototype.hasOwnProperty,D=[].slice;m=function(e,t){var n,o=u(e),r=o[0];return e=o[1],r&&(r=a(r,t),n=l(r)),r?e=n&&n.normalize?n.normalize(e,c(t)):a(e,t):(e=a(e,t),o=u(e),r=o[0],e=o[1],r&&(n=l(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},_={require:function(e){return i(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},p=function(e,t,n,a){var c,u,d,p,f,E,T=[];if(a=a||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(p=m(t[f],a),u=p.f,"require"===u)T[f]=_.require(e);else if("exports"===u)T[f]=_.exports(e),E=!0;else if("module"===u)c=T[f]=_.module(e);else if(r(g,u)||r(h,u)||r(v,u))T[f]=l(u);else{if(!p.p)throw new Error(e+" missing "+u);p.p.load(p.n,i(a,!0),s(u),{}),T[f]=g[u]}d=n.apply(g[e],T),e&&(c&&c.exports!==o&&c.exports!==g[e]?g[e]=c.exports:d===o&&E||(g[e]=d))}else e&&(g[e]=n)},e=t=f=function(e,t,n,r,a){return"string"==typeof e?_[e]?_[e](t):l(m(e,t).f):(e.splice||(E=e,t.splice?(e=t,t=n,n=null):e=o),t=t||function(){},"function"==typeof n&&(n=r,r=a),r?p(o,e,t,n):setTimeout(function(){p(o,e,t,n)},4),f)},f.config=function(e){return E=e,E.deps&&f(E.deps,E.callback),f},n=function(e,t,n){t.splice||(n=t,t=[]),r(g,e)||r(h,e)||(h[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almondLib",function(){}),function(e){function t(e,t){var n,o,i=e.parentNode;if(i||a||(i=document.createDocumentFragment(),i.appendChild(e)),r)return r.call(e,t);for(n=i.querySelectorAll(t),o=n.length;o--;)if(n[o]===e)return!0;return!1}var o=Element.prototype,r=o.matches||o.mozMatchesSelector||o.msMatchesSelector||o.oMatchesSelector||o.webkitMatchesSelector,a=function(){return r?r.call(document.createElement("a"),"a"):!1}();"object"==typeof exports?module.exports=t:"function"==typeof n&&n.amd?n("matches",[],function(){return t}):e.matches=t}(this),function(e){function o(e){function t(e){if(!o(e))throw new Error("delegate(): The argument must be an Element or Document Node");return r=e,t}function n(t,n,o){for(;n&&n!==t;){if(e(n,o))return n;n=n.parentElement}return null}function o(e){return e&&e.nodeName&&(3===e.nodeType||9===e.nodeType)?!0:!1}var r;return t.on=function(e,o,a,i,c){function s(i){(i.delegateTarget=n(r,i.target,o))&&(c===!0&&t(r).off(e,s),a.call(r,i))}return a._delegateWrapper=s,r.addEventListener(e,s,i||!1),a},t.once=function(e,n,o,r){t.on(e,n,o,r,!0)},t.off=function(e,t,n){t._delegateWrapper&&(t=t._delegateWrapper),r.removeEventListener(e,t,n||!1)},t}"object"==typeof exports?module.exports=o(t("matches")):"function"==typeof n&&n.amd?n("delegate",["matches"],o):e.delegate=o(e.matches)}(this),n("common/xhrhelper",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(){var e={httpMethodTypes:{GET:"get",POST:"post",PUT:"put",DELETE:"delete"},sendRequest:function(e,t,n,o){var r=new XMLHttpRequest;r.addEventListener("load",n.onSuccess,!0),r.addEventListener("error",n.onFailure,!0),r.addEventListener("abort",n.onFailure,!0),void 0!==o&&(r._requestId=o),"boolean"==typeof n.withCredentials&&(r.withCredentials=n.withCredentials),r.open(e,t,"boolean"==typeof n.async?n.async:!0);for(var a in n.headers)n.headers.hasOwnProperty(a)&&r.setRequestHeader(a,n.headers[a]);n.body?r.send(n.body):r.send()},get:function(t,n,o){e.sendRequest(e.httpMethodTypes.GET,t,n,o)},post:function(t,n,o){e.sendRequest(e.httpMethodTypes.POST,t,n,o)}};return e}}),n("../native/js/form-handler",["require","exports","module","delegate","common/xhrhelper"],function(e,t,n){var o=e("delegate"),r=e("common/xhrhelper");n.exports=function(){var e={xhrHelper:new r,selectors:{FORM:".js-form",CALL_TO_ACTION:".js-submitForm",ROOT_TOGGLE_ELEMENT:".hasToggleElements",CARD_IFRAME:".js-macaw-cards-iframe-container iframe",SUCCESS_MESSAGE:".PromotionCardFull--SuccessMessage"},classes:{SUCCESS_ELEMENTS:"successElements",ERROR_ELEMENTS:"errorElements"},resizeEvent:null,resizeEventObject:null,init:function(){o(document).on("click",e.selectors.CALL_TO_ACTION,e.submitForm),document.createEvent?(e.resizeEvent=document.createEvent("Event"),e.resizeEvent.initEvent("resize",!0,!0)):document.createEventObject&&(e.resizeEventObject=document.createEventObject("Event"),e.resizeEventObject.eventType="resize")},teardown:function(){o(document).off("click",e.submitForm)},submitForm:function(t){t.preventDefault();var n=document.querySelector(e.selectors.FORM);if(n){var o=e.getFormData(n);e.xhrHelper.sendRequest(e.xhrHelper.httpMethodTypes.POST,n.action,{onSuccess:e.handleSuccessResponse,onFailure:e.handleErrorResponse,body:o,headers:null,withCredentials:!0})}},getFormData:function(e){var t,n,o=new FormData,r=e.querySelectorAll("input");for(t=0;n=r[t];t++)o.append(n.name,n.value);return o},handleSuccessResponse:function(t){try{var n=JSON.parse(t.target.responseText).data;if(n.display){document.querySelector(e.selectors.SUCCESS_MESSAGE).innerHTML=n.display;var o=document.querySelectorAll(e.selectors.SUCCESS_MESSAGE+" a");for(i=0;el=o[i];i++)e.toggleClassOn(el,"js-openLink"),el.setAttribute("data-pe-name","card_url_click")}}catch(r){}e.handleResponse(e.classes.SUCCESS_ELEMENTS,e.classes.ERROR_ELEMENTS)},handleErrorResponse:function(){e.handleResponse(e.classes.ERROR_ELEMENTS,null)},handleResponse:function(t,n){var o=document.querySelector(e.selectors.ROOT_TOGGLE_ELEMENT);o&&(t&&e.toggleClassOn(o,t),n&&e.toggleClassOff(o,n),e.resizeIframe())},toggleClassOff:function(t,n){t.className=t.className.replace(e.getClassStringRegEx(n),"")},toggleClassOn:function(t,n){t.className.match(e.getClassStringRegEx(n))||(t.className+=" "+n)},getClassStringRegEx:function(e){return new RegExp("(?:^|\\s)"+e+"(?!\\S)","g")},resizeIframe:function(){e.resizeEvent?window.dispatchEvent(e.resizeEvent):e.resizeEventObject&&window.fireEvent("on"+e.resizeEventObject.eventType,e.resizeEventObject)}};return e.init(),e}}),function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return"undefined"==typeof e}function r(t){return e.xdm=w,T=t,T&&(y="xdm_"+T.replace(".","_")+"_"),D}function a(e){if(!e)throw new Error("url is undefined or empty");if(/^file/.test(e))throw new Error("The file:// protocol is not supported");var t=e.toLowerCase().match(h);if(t){var n=t[2],o=t[3],r=t[4]||"";return("http:"===n&&":80"===r||"https:"===n&&":443"===r)&&(r=""),n+"//"+o+r}return e}function i(e){if(!e)throw new Error("url is undefined or empty");if(e=e.replace(v,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":location.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=location.protocol+"//"+location.host+t+e}for(;E.test(e);)e=e.replace(E,"");return e}function c(e,t){if(!t)throw new Error("parameters is undefined or null");var n=e.indexOf("#"),o=[];for(var r in t)t.hasOwnProperty(r)&&o.push(r+"="+encodeURIComponent(t[r]));return e+(-1===n?"#":"&")+o.join("&")}function s(e,t,n){var o;for(var r in t)t.hasOwnProperty(r)&&(r in e?(o=t[r],"object"==typeof o?s(e[r],o,n):n||(e[r]=t[r])):e[r]=t[r]);return e}function l(e){var t=m.cloneNode(!1);if(s(e.props,{frameBorder:0,allowTRansparency:!0,scrolling:"no",width:"100%",src:c(e.remote,{xdm_e:a(location.href),xdm_c:e.channel,xdm_p:1}),name:y+e.channel+"_provider",style:{margin:0,padding:0,border:0}}),t.id=e.props.name,delete e.props.name,!e.container)throw new Error('xdm.Rpc() configuration object missing a DOM "container" property');return s(t,e.props),e.container.appendChild(t),e.onLoad&&C(t,"load",e.onLoad),e.html&&(t.contentWindow.document.open(),t.contentWindow.document.write(e.html),t.contentWindow.document.close()),e.iframe=t,t}function u(e,t){"string"==typeof e&&(e=[e]);for(var n,o=e.length;o--;)if(n=e[o],n=new RegExp("^"===n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function d(e){var t;if(e.isHost=e.isHost||o(I.xdm_p),e.props=e.props||{},e.isHost)e.remote=i(e.remote),e.channel=e.channel||"default"+_++;else if(e.channel=I.xdm_c.replace(/["'<>\\]/g,""),e.remote=I.xdm_e.replace(/["'<>\\]/g,""),e.acl&&!u(e.acl,e.remote))throw new Error("Access denied for "+e.remote);return t=[new D.stack.PostMessageTransport(e)],t.push(new D.stack.QueueBehavior(!0)),t}function p(e){var t,n,o=e.length,r={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(n=0;o>n;n++)t=e[n],s(t,r,!0),0!==n&&(t.down=e[n-1]),n!==o-1&&(t.up=e[n+1]);return t}function f(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var m=document.createElement("IFRAME"),_=Math.floor(1e4*Math.random()),g=Function.prototype,h=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,E=/[\-\w]+\/\.\.\//,v=/([^:])\/\//g,T="",D={},w=e.xdm,y="xdm_",I=function(e){e=e.substring(1,e.length).split("&");for(var t,n={},o=e.length;o--;)t=e[o].split("="),n[t[0]]=decodeURIComponent(t[1]);return n}(location.hash),C=function(){return e.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)}}(),O=function(){return e.removeEventListener?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)}}();s(D,{version:"1.0.0",query:I,stack:{},noConflict:r}),D.Rpc=function(e,t){var n;if(t.local)for(var o in t.local)t.local.hasOwnProperty(o)&&(n=t.local[o],"function"==typeof n&&(t.local[o]={method:n}));var r=p(d(e).concat([new D.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=a(e.remote),this.destroy=function(){r.destroy()},r.init(),this.iframe=e.iframe},D.stack.PostMessageTransport=function(t){function n(e){var n=a(e.origin),r="string"==typeof e.data;n===c&&r&&e.data.substring(0,t.channel.length+1)===t.channel+" "&&o.up.incoming(e.data.substring(t.channel.length+1),n)}var o,r,i,c;return o={outgoing:function(e,n,o){i.postMessage(t.channel+" "+e,n||c),o&&o()},destroy:function(){O(e,"message",n),r&&(i=null,r.parentNode.removeChild(r),r=null)},init:function(){if(c=a(t.remote),t.isHost){var s=function(a){a.data===t.channel+"-ready"&&(i="postMessage"in r.contentWindow?r.contentWindow:r.contentWindow.document,O(e,"message",s),C(e,"message",n),setTimeout(function(){o.up.callback(!0)},0))};C(e,"message",s),r=l(t)}else C(e,"message",n),i="postMessage"in e.parent?e.parent:e.parent.document,i.postMessage(t.channel+"-ready",c),setTimeout(function(){o.up.callback(!0)},0)}}},D.stack.QueueBehavior=function(e){function t(){var i;return e===!0&&0===r.length?void f(n):void(a||0===r.length||o||(a=!0,i=r.shift(),n.down.outgoing(i.data,i.origin,function(e){a=!1,i.callback&&setTimeout(function(){i.callback(e)},0),t()})))}var n,o,r=[],a=!0;return n={init:function(){n.down.init()},callback:function(e){a=!1;var o=n.up;t(),o.callback(e)},incoming:function(e,t){n.up.incoming(e,t)},outgoing:function(e,n,o){r.push({data:e,origin:n,callback:o}),t()},destroy:function(){o=!0,n.down.destroy()}}},D.stack.RpcBehavior=function(e,n){function r(e){e.jsonrpc="2.0",c.down.outgoing(JSON.stringify(e))}function a(e,t){var n=Array.prototype.slice;return function(){var o,a=arguments.length,i={method:t};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(o={success:arguments[a-2],error:arguments[a-1]},i.params=n.call(arguments,0,a-2)):(o={success:arguments[a-1]},i.params=n.call(arguments,0,a-1)),l[""+ ++s]=o,i.id=s):i.params=n.call(arguments,0),e.namedParams&&1===i.params.length&&(i.params=i.params[0]),r(i)}}function i(e,n,a,i){if(!a)return void(n&&r({id:n,error:{code:-32601,message:"Procedure not found."}}));var c,s;n?(c=function(e){c=g,r({id:n,result:e})},s=function(e,t){s=g;var o={id:n,error:{code:-32099,message:e}};t&&(o.error.data=t),r(o)}):c=s=g,t(i)||(i=[i]);try{var l=a.method.apply(a.scope,i.concat([c,s]));o(l)||c(l)}catch(u){s(u.message)}}var c,s=0,l={};return c={incoming:function(e){var t,o=JSON.parse(e);o.method?n.handle?n.handle(o,r):i(o.method,o.id,n.local[o.method],o.params):(t=l[o.id],o.error&&t.error?t.error(o.error):t.success&&t.success(o.result),delete l[o.id])},init:function(){if(n.remote)for(var t in n.remote)n.remote.hasOwnProperty(t)&&(e[t]=a(n.remote[t],t));c.down.init()},destroy:function(){for(var t in n.remote)n.remote.hasOwnProperty(t)&&e.hasOwnProperty(t)&&delete e[t];c.down.destroy()}}},"object"==typeof exports?module.exports=D:"function"==typeof provide?provide(D):"function"==typeof n&&n.amd?n("xdm",[],function(){return D}):e.xdm=D}(window),n("unification/logger",["require","exports","module"],function(e,t,n){"use strict";function o(e){return function(){if(window.DEBUG){var t=Array.prototype.slice.apply(arguments);t.unshift(e),console.log.apply(console,t)}}}n.exports=o}),n("common/utils",["require","exports","module","unification/logger"],function(e,t,n){"use strict";var o=e("unification/logger")("[UTILS]"),r={getConfigFromJsonIn:function(e){var t,n=document.getElementById(e),r=null;if(!n)return o(["Element with id",e,"not found"].join(" ")),r;t=n.innerHTML;try{r=JSON.parse(t)}catch(a){o(["Error while parsing json in element",e].join(" "),a)}return r},isEmpty:function(e){return!r.isDefined(e)||"string"==typeof e&&0===e.length},isDefined:function(e){return"undefined"!=typeof e&&null!==e},isObject:function(e){return r.isDefined(e)&&"object"==typeof e},toArray:function(e){return Array.prototype.slice.call(e,0)},escapeHtml:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},decodeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue},trigger:function(e,t){var n=new Event(t);e.dispatchEvent(n)},getFollowElements:function(e){var t,n=e&&e.target;if(n){for(;!n.dataset.userId&&n.parentElement;)n=n.parentElement;return t=n.dataset.userId,r.fetchTargetElement("data-user-id",t)}return[]},fetchTargetElement:function(e,t){var n="*["+e+'="'+t+'"]';return r.toArray(document.querySelectorAll(n))},createUrl:function(e,t){var n=e;n+=-1!==n.indexOf("?")?"&":"?";for(var o in t)n=n+encodeURIComponent(o)+"="+encodeURIComponent(t[o])+"&";return n.substr(0,n.length-1)},getTarget:function(e){return e.target},extend:function(e){var t,n,o=Array.prototype.slice.call(arguments,1);for(t in o){var r=o[t];for(n in r)void 0!==r[n]&&(e[n]=r[n])}return e}};n.exports=r}),n("common/video-interface-manager",["require","exports","module","delegate","xdm","common/utils"],function(e,t,n){"use strict";function o(){var e=d.getConfigFromJsonIn("video-config"),t="";return"undefined"!=typeof e&&null!==e&&(t=d.createUrl(e.video_player_url,e.params)),t}function r(){return document.querySelectorAll(".VideoContainer")}function a(){var e=document.getElementById("ExternalIframeContainer");return e&&e.className.match(/\bAmplifyContainer\b/)?e:void 0}function i(e,t){return function(n){var o=Array.prototype.slice.call(arguments),r=o.length-2,a=o.length-1,i=o[r],c=o[a],s=function(e){if("requestPlayerConfig"===n){var o,e=e||{};try{o=JSON.parse(t.getAttribute("data-player-config"))}catch(r){o={}}return d.extend(e,o)}return e};o[r]=function(e){i(s(e))},o[a]=function(){"requestPlayerConfig"===n?i(s()):c(s())},e.callVideoHostMethod.apply(e,o)}}function c(e,t,n){var o=new u.Rpc({remote:t,container:e,isHost:!0},{local:{callVideoHostMethod:i(n,e)},remote:{callMethodByName:{}}});return o.iframe.setAttribute("allowfullscreen",""),o}function s(e){for(var t,n,a,i,s=r(),l=0;l<s.length;l++)t=s[l],n={vmap_url:t.getAttribute("data-src"),image_src:t.getAttribute("data-thumbnail"),content_id:t.getAttribute("data-content-id"),type:t.getAttribute("data-type")},i=d.createUrl(o(),n),a=c(t,i,e),e.attachVideoInterface(a)}function l(e){var t,n,o=a();o&&(t=o.getAttribute("data-player-url"),n=c(o,t,e),e.attachVideoInterface(n))}var u=(e("delegate"),e("xdm")),d=e("common/utils"),p={init:function(e){s(e),l(e)},isSupported:function(){var e=r(),t=a();return e.length>0||"undefined"!=typeof t},getCallVideoHostMethod:i};n.exports=p}),n("../native/js/flex-embed",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(){var e,t,n=document.getElementById("ExternalIframeContainer");n&&(e=n.getAttribute("data-iframe-aspect-ratio-numerator"),t=n.getAttribute("data-iframe-aspect-ratio-denominator"),n.style.paddingBottom=100*t/e+"%")}}),n("../native/js/api-request",["require","exports","module","common/xhrhelper"],function(e,t,n){"use strict";var o=e("common/xhrhelper");n.exports=function(e,t){var n=new o,r=function(){this.status>=200&&this.status<=299?e(this,this._requestId):t(this,this._requestId)},a=function(){t(this,this._requestId)},i={getRequest:function(e,t,o,i){n.get(t,{onSuccess:r,onFailure:a,body:o,withCredentials:i},e)},postRequest:function(e,t,o,i){n.post(t,{onSuccess:r,onFailure:a,body:o,withCredentials:i},e)}};return i}}),n("../native/js/card-data-broker",["require","exports","module","./api-request"],function(e,t,n){"use strict";var o=e("./api-request");n.exports=function(e){var t=2e4,n={GET:"get",POST:"post"},r={_apiRequest:null,_requestUrl:null,_onDataUpdate:null,_onRequestError:null,_lastRequestIndex:0,_activeRequests:{},_pendingRequests:{},register:function(e,t){r._onDataUpdate=e,r._onRequestError=t,r._apiRequest=new o(r._onSuccess,r._onFailure),r._requestUrl=r._buildRequestUrl()},unregister:function(){r.cancelAll(),r._onDataUpdate=null,r._onRequestError=null},doRead:function(e,t){if(r._requestUrl){var n=r._genNewId();return r._doReadInternal(n,e,t)}},doWrite:function(e){if(r._requestUrl){var t=r._genNewId();return r._doWriteInternal(t,e)}},cancel:function(e){delete r._activeRequests[e],delete r._pendingRequests[e]},cancelAll:function(){r._activeRequests={},r._pendingRequests={}},_genNewId:function(){return r._lastRequestIndex=r._lastRequestIndex+1,r._lastRequestIndex},_buildRequestUrl:function(){var t="/i/cards/api/v1.json",n=window.location.host,o=window.location.protocol;return void 0!==e.tweetId&&void 0!=e.cardName&&void 0!==e.token&&void 0!==e.forward&&void 0!==e.uri?o+"//"+n+t+"?tweet_id="+e.tweetId+"&card_name="+r._escapeString(e.cardName)+"&authenticity_token="+e.token+"&forward="+e.forward.toString()+"&capi_uri="+r._escapeString(e.uri):void 0},_findAndResetRequest:function(e){var t=r._activeRequests[e];return delete r._activeRequests[e],void 0!=t&&t.repeat&&(r._pendingRequests[e]=t),t},_escapeString:function(e){return encodeURIComponent(e)},_onTick:function(){for(var e in r._pendingRequests){var t=r._pendingRequests[e];r._doReadInternal(e,t.request,t.repeat)}r._pendingRequests={}},_doReadInternal:function(e,t,o){var a=JSON.stringify(t),i=r._requestUrl+"&body="+r._escapeString(a);return r._activeRequests[e]={request:t,method:n.GET,repeat:o===!0},r._apiRequest.getRequest(e,i,a,!0),e},_doWriteInternal:function(e,t){var o=JSON.stringify(t);return r._activeRequests[e]={request:t,method:n.POST,repeat:!1},r._apiRequest.postRequest(e,r._requestUrl,o,!0),e},_onSuccess:function(t,n){var o=r._findAndResetRequest(n);void 0!==o&&"function"==typeof r._onDataUpdate&&r._onDataUpdate(e.original,JSON.parse(t.response),n)},_onFailure:function(t,n){var o=r._findAndResetRequest(n);void 0!==o&&"function"==typeof r._onRequestError&&r._onRequestError(e.original,{},n)}};return window.setInterval(r._onTick,t),r}}),n("../native/js/card-helper",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(){var e={showElement:function(t){var n=e.queryElement(t);n&&(n.style.display="block")},hideElement:function(t){var n=e.queryElement(t);n&&(n.style.display="none")},setContent:function(t,n){var o=e.queryElement(t);o&&(o.innerHTML=n)},queryElement:function(e){var t=document.querySelector(e);return t||console.log('Element with selector "'+e+'" is not found.'),t}};return e}}),n("../native/js/card-page-controller",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(){var e={_currentPage:null,_loadPage:function(e){e&&"function"==typeof e.load&&e.load()},_unloadPage:function(e){e&&"function"==typeof e.unload&&e.unload()},init:function(t){e._loadPage(t),e._currentPage=t},switchToPage:function(t){return t!==e.currentPage?(e._unloadPage(e._currentPage),e._loadPage(t),e._currentPage=t,e._currentPage):void 0},getCurrentPage:function(){return e._currentPage}};return e}}),n("../native/js/poll_shared/card-poll",["require","exports","module","delegate","./../card-data-broker","./../card-helper","./../card-page-controller"],function(e,t,n){"use strict";{var o=(e("delegate"),e("./../card-data-broker"),e("./../card-helper"));e("./../card-page-controller")}n.exports=function(e){var t={attribute:{POLL_OPTION:"data-poll-option",POLL_COMPLETED:"data-poll-completed"},selector:{PAGE_RESULT:".PollCardShared-resultPage",PAGE_VOTING:".PollCardShared-votingPage",CONTAINER:".PollCardShared"},cardHelper:new o,pollContainer:null,pollOptions:null,twitterInterface:e,init:function(){t.pollContainer=document.querySelector(t.selector.CONTAINER),t.pollOptions=t.pollContainer.querySelectorAll(t.selector.PAGE_VOTING+" ["+t.attribute.POLL_OPTION+"]");for(var e,n=0;e=t.pollOptions[n];n++)e.addEventListener("click",t.handleOptionClick);t.pollContainer&&!t.pollContainer.getAttribute(t.attribute.POLL_COMPLETED)&&(t.cardHelper.hideElement(t.selector.PAGE_RESULT),t.twitterInterface.handleResize())},handleOptionClick:function(){var e=this.getAttribute(t.attribute.POLL_OPTION);e&&e.length<140&&(e+=" "),t.twitterInterface.composeTweet({tweetText:e||"",scribeData:t.twitterInterface.config.scribeData});for(var n,o=0;n=t.pollOptions[o];o++)n.removeEventListener("click",t.handleOptionClick);setTimeout(function(){t.cardHelper.showElement(t.selector.PAGE_RESULT),t.cardHelper.hideElement(t.selector.PAGE_VOTING),t.twitterInterface.handleResize()},500)}};return t}}),n("../native/js/ext/parameterize",["require","exports","module"],function(e,t,n){var o=/\{\{(.+?)\}\}/g;n.exports=function(e,t,n){return t?e.replace(o,function(e,o){if(o){if(t[o])return t[o];if(n)throw new Error("Cannot parameterize string, no replacement found for "+o);return""}return e}):e}}),n("../native/js/ext/i18n",["require","exports","module","./parameterize"],function(e,t,n){n.exports=e("./parameterize")}),n("../native/js/consumer-poll/poll2choice-text-only",["require","exports","module","./../ext/i18n","./../card-data-broker","./../card-helper","./../card-page-controller"],function(e,t,n){"use strict";var o=e("./../ext/i18n"),r=e("./../card-data-broker"),a=e("./../card-helper"),i=e("./../card-page-controller");n.exports=function(e,t){var n=1e3,c=60,s=60*c,l=24*s,u=1*n,d=s*n,p=c*n*10,f=c*n/2,m=500,_={attributes:{CHOICE_ATTRIBUTE_NAME:"data-poll-choice",INDEX_ATTRIBUTE_NAME:"data-poll-index",STATE_ATTRIBUTE_NAME:"data-choice-state",SELECTED_STATE_VALUE:"selected",UPDATE_ANIMATION_ATTRUBUTE:"data-update-animation",UPDATE_ANIMATION_ON:"on",UPDATE_ANIMATION_OFF:"off",DISABLED_ATTRIBUTE_NAME:"disabled"},selectors:{CONTAINER:"div.Poll2ChoiceTextOnly",VOTING_PAGE:"div.Poll2ChoiceTextOnly-page--voting",VOTED_PAGE:"div.Poll2ChoiceTextOnly-page--voted",RESULT_PAGE:"div.Poll2ChoiceTextOnly-page--result",OPTIONS:".Poll2ChoiceTextOnly-radio label",VOTE_BUTTON:"button.Poll2ChoiceTextOnly-vote",SELECTED_TEXT:".Poll2ChoiceTextOnly-text--selected",RESULT_OPTION:".Poll2ChoiceTextOnly-text--option",RESULT_TEXT:".Poll2ChoiceTextOnly-text--result",FOOTER_TOTAL:".Poll2ChoiceTextOnly-footer--total",FOOTER_TIME:".Poll2ChoiceTextOnly-footer--time",BOLD_CLASS:"tcu-textBold"},actions:{CHOOSE:"click",VOTE:"click"},strings:{VOTE_ENABLED:"Vote",VOTE_SUBMITTED:"Vote submitted",POLL_ENDED:"Poll has ended",POLL_ENDING:"Poll is ending"},cardHelper:new a,pageController:new i,twitterInterface:e,cardStorage:t,cardDatabroker:null,tweetId:null,eventUri:null,cardUri:null,viewerId:null,userChoice:null,userVote:null,pollContainer:null,choice1CountMax:null,choice2CountMax:null,isOpen:null,hasTimeLeft:!0,endTime:null,dataPollingRequestId:null,votingRequestId:null,_showUserChoice:function(e){if(null!==_.userVote){var t=e+" div["+_.attributes.INDEX_ATTRIBUTE_NAME+'="'+_.userVote+'"] '+_.selectors.SELECTED_TEXT,n=_.cardHelper.queryElement(t);n&&n.setAttribute(_.attributes.STATE_ATTRIBUTE_NAME,_.attributes.SELECTED_STATE_VALUE)}},_setContentWithAnimation:function(e,t){var n=""===e.textContent;e.textContent=t,n||(e.setAttribute(_.attributes.UPDATE_ANIMATION_ATTRUBUTE,_.attributes.UPDATE_ANIMATION_ON),window.setTimeout(function(){e.setAttribute(_.attributes.UPDATE_ANIMATION_ATTRUBUTE,_.attributes.UPDATE_ANIMATION_OFF)},m))},_formatNumber:function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},_setResult:function(e,t,n){var o=e+" div["+_.attributes.INDEX_ATTRIBUTE_NAME+'="'+t+'"] '+_.selectors.RESULT_TEXT,r=_.cardHelper.queryElement(o);r&&(r.textContent=n)},_setWinner:function(e,t){var n=e+" div["+_.attributes.INDEX_ATTRIBUTE_NAME+'="'+t+'"]',o=_.cardHelper.queryElement(n);o&&o.classList.add(_.selectors.BOLD_CLASS)},_showWinner:function(e){var t=Math.max(_.choice1CountMax,_.choice2CountMax);_.choice1CountMax===t&&_._setWinner(e,1),_.choice2CountMax===t&&_._setWinner(e,2)},_generateTotalString:function(e){var t=_._chooseUnitString(e,o("votes"),o("vote"),o("votes"),o("votes"));return o("{{number}} {{unit}}",{number:_._formatNumber(e),unit:t})},_setTotal:function(e){var t=_.cardHelper.queryElement(_.selectors.FOOTER_TOTAL);if(t){var n=_._generateTotalString(e);n!==t.textContent&&_._setContentWithAnimation(t,n)}},_chooseUnitString:function(e,t,n,o,r){switch(e){case 0:return t;case 1:return n;case 2:return o;default:return r}},_generateTimeLeftString:function(e){var t,n;return e>=l?(n=e/l,n=Math.floor(n),t=_._chooseUnitString(n,o("days"),o("day"),o("days"),o("days")),window.setTimeout(_._updateEndTime,d)):e>=s?(n=e/s,n=Math.floor(n),t=_._chooseUnitString(n,o("hours"),o("hour"),o("hours"),o("hours")),window.setTimeout(_._updateEndTime,p)):(n=e/c,n=Math.floor(n),t=_._chooseUnitString(n,o("minutes"),o("minute"),o("minutes"),o("minutes")),window.setTimeout(_._updateEndTime,f)),o("{{number}} {{unit}} {{left}}",{number:_._formatNumber(n),unit:t,left:o("left")})},_updateEndTime:function(){var e,t=Math.floor((_.endTime-Date.now())/n);e=_.isOpen?c>t?o(_.strings.POLL_ENDING):_._generateTimeLeftString(t):o(_.strings.POLL_ENDED);var r=_.cardHelper.queryElement(_.selectors.FOOTER_TIME);r&&r.textContent!==e&&_._setContentWithAnimation(r,e)},_calculatePercentage:function(e,t){return 0===t?0:e>=t?100:Math.round(e/t*100)},_updateResults:function(e){var t=_.choice1CountMax+_.choice2CountMax;if(_._setTotal(t),void 0!==e){var n="0%",o="0%";if(t>0){var r=_._calculatePercentage(_.choice1CountMax,t),a=100-r;n=r+"%",o=a+"%"}_._setResult(e,1,n),_._setResult(e,2,o)}},_updateVoteOptions:function(){if(!_.hasTimeLeft||!_.isOpen)for(var e,t=_.pollContainer.querySelectorAll(_.selectors.OPTIONS),n=0;e=t[n];n++)e.setAttribute(_.attributes.DISABLED_ATTRIBUTE_NAME,!0),e.removeEventListener(_.actions.VOTE)},_updateVoteButton:function(){_.voteButton&&(_.isOpen&&_.hasTimeLeft&&null!==_.userChoice&&null===_.userVote?(_.voteButton.addEventListener(_.actions.VOTE,_._handleVoteClick),_.voteButton.removeAttribute(_.attributes.DISABLED_ATTRIBUTE_NAME)):(_.voteButton.setAttribute(_.attributes.DISABLED_ATTRIBUTE_NAME,!0),_.voteButton.textContent=o(null!==_.votingRequestId||null!==_.userVote?_.strings.VOTE_SUBMITTED:_.strings.VOTE_ENABLED)))},_countVote:function(){if(_.isOpen)switch(_.userVote){case"1":_.choice1CountMax=_.choice1CountMax+1;break;case"2":_.choice2CountMax=_.choice2CountMax+1}},_postVote:function(e){null!==e&&null!==_.eventUri&&null!==_.cardDatabroker&&(_.votingRequestId=_.cardDatabroker.doWrite({"twitter:string:card_uri":_.cardUri,"twitter:long:original_tweet_id":_.tweetId,"twitter:string:selected_choice":e}))},_startDataPolling:function(){null===_.dataPollingRequestId&&null!==_.cardDatabroker&&(_.dataPollingRequestId=_.cardDatabroker.doRead({"twitter:string:card_uri":_.cardUri,"twitter:long:original_tweet_id":_.tweetId},!0))},_stopDataPolling:function(){null!==_.dataPollingRequestId&&null!==_.cardDatabroker&&(_.cardDatabroker.cancel(_.dataPollingRequestId),_.dataPollingRequestId=null)},_hideAllPages:function(){_.cardHelper.hideElement(_.selectors.VOTING_PAGE),_.cardHelper.hideElement(_.selectors.VOTED_PAGE),_.cardHelper.hideElement(_.selectors.RESULT_PAGE)},_handleDataUpdate:function(e,t,n){if(n===_.votingRequestId){_.userVote=_.userChoice,_._countVote(),_._updateVoteButton();var o={userVote:_.userVote};_.cardStorage&&_.cardStorage.setData(o,function(){}),_.votingRequestId=null}_.isOpen=!t.countsAreFinal;var r=Number(t.choice1Count),a=Number(t.choice2Count);_.isOpen?(r>_.choice1CountMax&&(_.choice1CountMax=r),a>_.choice2CountMax&&(_.choice2CountMax=a)):(_.choice1CountMax=r,_.choice2CountMax=a),_.pageController.getCurrentPage().onDataUpdate(e,t,n)},_handleDataError:function(e,t,n){n===_.votingRequestId&&(_.votingRequestId=null,_.pageController.switchToPage(_.votingPage))},_handleOptionClick:function(){var e=event.target.getAttribute(_.attributes.INDEX_ATTRIBUTE_NAME);_.userChoice=e,_._updateVoteButton()},_handleVoteClick:function(){var e=_.pageController.getCurrentPage();null!==_.userChoice&&e&&"function"==typeof e.onVote&&e.onVote()},_onTick:function(){},init:function(e){_.eventUri=e.card.capi,_.tweetId=e.card.tweet_id,_.cardUri=e.card.card_uri,_.viewerId=e.card.viewer_id,"undefined"!=typeof e.card.count1&&"undefined"!=typeof e.card.count2?(_.choice1CountMax=Number(e.card.count1),_.choice2CountMax=Number(e.card.count2)):(_.choice1CountMax=0,_.choice2CountMax=0),_.isOpen="true"===e.card.is_open;e.card.end_time;_.endTime=Date.parse(e.card.end_time);var t=Math.floor((_.endTime-Date.now())/n);if(0>=t&&(_.hasTimeLeft=!1),null!==_.cardStorage){var o=_.cardStorage.cache;o&&void 0!==o.userVote&&(_.userChoice=_.userVote=o.userVote)}_.isOpen?(_._countVote(),_.cardDatabroker=new r({tweetId:e.card.tweet_id,cardName:e.card.card_name,uri:e.card.capi,token:e.card.token,forward:e.card.forward,original:e.card.original}),_.cardDatabroker.register(_._handleDataUpdate,_._handleDataError),_.pageController.init(_.userVote||void 0===_.viewerId?_.votedPage:_.votingPage),_._startDataPolling(),window.setInterval(_._onTick,u)):_.pageController.init(_.resultPage),_.pollContainer=document.querySelector(_.selectors.CONTAINER);for(var a,i=_.pollContainer.querySelectorAll(_.selectors.OPTIONS),c=0;a=i[c];c++)a.addEventListener(_.actions.CHOOSE,_._handleOptionClick);_.voteButton=_.pollContainer.querySelectorAll(_.selectors.VOTE_BUTTON)[0],_._updateVoteButton(),_._updateResults(),_._updateEndTime()},deinit:function(){_._stopDataPolling(),null!==_.cardDatabroker&&(_.cardDatabroker.cancelAll(),_.cardDatabroker.unregister(),_.cardDatabroker=null)},resultPage:{load:function(){_._hideAllPages(),_.cardHelper.showElement(_.selectors.RESULT_PAGE),_._showUserChoice(_.selectors.RESULT_PAGE),_._stopDataPolling(),_._updateVoteButton(),_._updateResults(_.selectors.RESULT_PAGE),_._showWinner(_.selectors.RESULT_PAGE),_._updateEndTime()
}},votedPage:{load:function(){_._hideAllPages(),_.cardHelper.showElement(_.selectors.VOTED_PAGE),_._updateVoteButton(),_._updateResults(_.selectors.VOTED_PAGE)},onDataUpdate:function(){_._updateResults(_.selectors.VOTED_PAGE),_._showUserChoice(_.selectors.VOTED_PAGE),_.isOpen||_.pageController.switchToPage(_.resultPage)}},votingPage:{load:function(){_._hideAllPages(),_.cardHelper.showElement(_.selectors.VOTING_PAGE)},onVote:function(){null!==_.userChoice&&(_._postVote(_.userChoice),_._updateVoteButton(),_.pageController.switchToPage(_.votedPage))},onDataUpdate:function(){_._updateResults(),_.isOpen||_.pageController.switchToPage(_.resultPage)}}};return _}}),"undefined"!=typeof window&&!function(){"use strict";if(!window.LocalDepot){var e=window.LocalDepot={};e.onError=null,e.deviceStorageType=null,e.indexedDbVersion=2,e.DB_INDEXING_KEY="item",e.storageType={INDEXEDDB:"indexeddb",WEBSQL:"websql",LOCALSTORAGE:"localstorage"},e.Depot=function(t,n){this.name=t,this.storageType=n,this.getItem=function(t,n){e._Depot.getItem(this,t,n)},this.getKeys=function(t){e._Depot.getKeys(this,t)},this.setItem=function(t,n,o){e._Depot.setItem(this,t,n,o)},this.hasItem=function(t,n){e._Depot.hasItem(this,t,n)},this.removeItem=function(t,n){e._Depot.removeItem(this,t,n)},this.clear=function(){e._Depot.clear(this)}},e._Depot={getItem:function(t,n,o){t.storageType===e.storageType.INDEXEDDB&&e._Depot.openIndexedDb(t.name,e.indexedDbVersion,function(r){var a,i,c;i=r.transaction([t.name]),a=i.objectStore(t.name),c=a.get(n),c.onsuccess=function(t){var n=t.target.result;"function"==typeof o&&o(n?n.data:void 0),e._Depot.closeIndexedDb(r)},c.onerror=function(){"function"==typeof o&&o(void 0),e._Depot.closeIndexedDb(r)}})},getKeys:function(t,n){t.storageType===e.storageType.INDEXEDDB?e._Depot.openIndexedDb(t.name,e.indexedDbVersion,function(o){var r,a,i,c=[];a=o.transaction([t.name]),r=a.objectStore(t.name),i=r.openCursor(),i.onsuccess=function(t){var r=t.target.result;r?(c.push(r.value.item),r["continue"]()):("function"==typeof n&&n(c),e._Depot.closeIndexedDb(o))},i.onerror=function(){"function"==typeof n&&n(c),e._Depot.closeIndexedDb(o)}}):t.storageType===e.storageType.WEBSQL?"":t.storageType===e.storageType.LOCALSTORAGE},setItem:function(t,n,o,r){t.storageType===e.storageType.INDEXEDDB?e._Depot.openIndexedDb(t.name,e.indexedDbVersion,function(a){var i,c,s=a.transaction([t.name],"readwrite");i=s.objectStore(t.name),s.oncomplete=function(){"function"==typeof r&&r(!0),e._Depot.closeIndexedDb(a)},s.onerror=function(){"function"==typeof r&&r(!1),e._Depot.closeIndexedDb(a)},c=i.put({item:n,data:o})}):t.storageType===e.storageType.WEBSQL?"":t.storageType===e.storageType.LOCALSTORAGE},hasItem:function(t,n,o){t.storageType===e.storageType.INDEXEDDB?e._Depot.getItem(t,n,function(e){o("undefined"!=typeof e?!0:!1)}):t.storageType===e.storageType.WEBSQL?"":t.storageType===e.storageType.LOCALSTORAGE},removeItem:function(t,n,o){t.storageType===e.storageType.INDEXEDDB?e._Depot.openIndexedDb(t.name,e.indexedDbVersion,function(r){var a,i,c;i=r.transaction([t.name],"readwrite"),a=i.objectStore(t.name),c=a["delete"](n),c.onsuccess=function(){"function"==typeof o&&o(!0),e._Depot.closeIndexedDb(r)},c.onerror=function(){"function"==typeof o&&o(!1),e._Depot.closeIndexedDb(r)}}):t.storageType===e.storageType.WEBSQL?"":t.storageType===e.storageType.LOCALSTORAGE},clear:function(t){t.storageType===e.storageType.INDEXEDDB?e._Depot.openIndexedDb(t.name,e.indexedDbVersion,function(n){(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(t.name),e._Depot.closeIndexedDb(n)}):t.storageType===e.storageType.WEBSQL?"":t.storageType===e.storageType.LOCALSTORAGE},openIndexedDb:function(t,n,o){var r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(t,n);r.onerror=function(){o(null)},r.onupgradeneeded=function(){if(!r.result.objectStoreNames.contains(t)){var n=r.result.createObjectStore(t,{keyPath:e.DB_INDEXING_KEY});n.createIndex(e.DB_INDEXING_KEY,e.DB_INDEXING_KEY,{unique:!0})}},r.onsuccess=function(){"function"==typeof o&&o(r.result)}},closeIndexedDb:function(e){e&&e.close&&e.close()}},e.requestDepot=function(t,n,o){e._hasDepot(t,function(r){r?n(e._getDepot(t)):e._createDepot(t,n,o)})},e.hasDepot=function(t,n){"string"==typeof t&&"function"==typeof n?e._hasDepot(t,n):"function"==typeof n&&n(!1)},e.deleteDepot=function(t,n){if(e.deviceStorageType===e.storageType.INDEXEDDB){var o=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(t);o.onsuccess=function(){"function"==typeof n&&n(!0)},o.onerror=function(){"function"==typeof n&&n(!1)}}},e._hasDepot=function(t,n){if(e.deviceStorageType===e.storageType.INDEXEDDB){var o=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(t);o.onupgradeneeded=function(e){e.target.transaction.abort()},o.onsuccess=function(){"function"==typeof n&&(e._Depot.closeIndexedDb(o),n(!0))},o.onerror=function(){"function"==typeof n&&(e._Depot.closeIndexedDb(o),n(!1))}}},e._getDepot=function(t){return new e.Depot(t,e.deviceStorageType)},e._createDepot=function(t,n,o){e.deviceStorageType===e.storageType.INDEXEDDB?e._createIndexedDbInstance(t,n,o):""},e._createIndexedDbInstance=function(t,n,o){var r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(t,e.indexedDbVersion);r.onerror=function(t){"function"==typeof o&&o(t),"function"==typeof e.onError&&e.onError(t)},r.onupgradeneeded=function(){if(!r.result.objectStoreNames.contains(t)){var n=r.result.createObjectStore(t,{keyPath:e.DB_INDEXING_KEY});n.createIndex(e.DB_INDEXING_KEY,e.DB_INDEXING_KEY,{unique:!0})}},r.onsuccess=function(){"function"==typeof n&&(n(new e.Depot(t,e.storageType.INDEXEDDB)),e._Depot.closeIndexedDb(r.result))}},e._getStorageSupportedByBrowser=function(){var t;return void 0!==(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB)?t=e.storageType.INDEXEDDB:window.openDatabase?t=e.storageType.WEBSQL:"localStorage"in window&&(t=e.storageType.LOCALSTORAGE),t},e._init=function(){e.deviceStorageType=e._getStorageSupportedByBrowser()},e._init()}}(),n("../native/js/storage/localdepot.min",function(){}),n("../native/js/storage/card-storage",["require","exports","module","./localdepot.min"],function(e,t,n){"use strict";e("./localdepot.min"),n.exports=function(){var e={_depot:null,_name:null,_table:null,cache:null,getData:function(t){e._depot?e._depot.getItem(e._name,t):t()},setData:function(t,n){e._depot?e._depot.setItem(e._name,t,n):e._getDepot(e._table,function(){e.setData(t,n)})},hasData:function(){},removeData:function(){},init:function(t,n,o){e._table=t,e._name=n,LocalDepot.hasDepot(t,function(n){n?e._getDepot(t,o):o(!1)})},_getDepot:function(t,n){LocalDepot.requestDepot(t,function(t){e._depot=t,e.getData(function(t){e.cache=t,n(!0)})},function(){n(!1)})}};return e}}),n("../native/js/flock/flock2unlock",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(e){var t={_twitterInterface:e,_cardData:null,_cardStorage:null,init:function(e,n,o){t._cardData=e,t._cardStorage=n,e.locked?t._cardStorage.getData(t._showLocked):e.video_unlocked&&"function"==typeof o&&o()},_showLocked:function(e){var n=parseInt(t._cardData.percentage),o=document.querySelector(".FlockCard-progress span"),r=document.querySelector(".FlockCard-image img");if(r.addEventListener("load",t._twitterInterface.handleResize),setTimeout(function(){o.style.width=n+"%"},100),e&&e.voted)t._showParticipated();else{var a=document.querySelector(".FlockCard-button--cta button");a&&a.addEventListener("click",t._handleTweetToUnlock),r&&(r.src=r.getAttribute("data-src")),t._twitterInterface.handleResize()}},_showParticipated:function(){var e=document.querySelector(".FlockCard-button--cta");e&&(e.parentElement.removeChild(e),document.querySelector(".FlockCard-image img").src=t._cardData.participated_image.image_url),t._twitterInterface.handleResize()},_handleTweetToUnlock:function(){var e=t._cardData.compose;e&&e.length<140&&(e+=" "),setTimeout(t._showParticipated,150),t._twitterInterface.composeTweet({tweetText:e||"",scribeData:t._twitterInterface.config.scribeData}),t._cardStorage.setData({voted:!0})}};return t}}),n("../native/js/initialize",["require","exports","module","./form-handler","common/video-interface-manager","./flex-embed","./poll_shared/card-poll","./consumer-poll/poll2choice-text-only","./storage/card-storage","./flock/flock2unlock"],function(e,t,n){"use strict";n.exports=function(t){var n={modules:{Interface:t,FormHandler:e("./form-handler"),VideoInterfaceManager:e("common/video-interface-manager"),flexEmbed:e("./flex-embed"),CardPoll:e("./poll_shared/card-poll"),Poll2ChoiceTextOnly:e("./consumer-poll/poll2choice-text-only"),CardStorage:e("./storage/card-storage"),FlockCard:e("./flock/flock2unlock")},serialization:{CARD:"twitter-cards-serialization"},twitterInterface:null,cardStorage:null,CARD_STORAGE_NAMESPACE_PREFIX:"cards_kernel_",init:function(){var e=n.getSerialization(n.serialization.CARD);e&&(!e.card||"poll2choice_text_only"!==e.card.card_name&&"2485840682:flock"!==e.card.card_name&&"2485840682:flock_v2"!==e.card.card_name?n._initCard(e):(n.cardStorage=new n.modules.CardStorage,n.cardStorage.init(n.CARD_STORAGE_NAMESPACE_PREFIX+e.card.card_name,n.CARD_STORAGE_NAMESPACE_PREFIX+escape(e.card.card_uri)+"_"+e.card.viewer_id,function(){n._initCard(e)})))},getSerialization:function(e){var t,n=document.querySelector('script[type="text/'+e+'"]');try{t=JSON.parse(n.textContent||n.innerHTML)}catch(o){}return t},_initPlayer:function(){n.modules.VideoInterfaceManager.isSupported()&&n.modules.VideoInterfaceManager.init(n.twitterInterface),n.modules.flexEmbed()},_initPoll:function(){var e=new n.modules.CardPoll(n.twitterInterface);e.init()},_initConsumerPoll:function(e){var t=new n.modules.Poll2ChoiceTextOnly(n.twitterInterface,n.cardStorage);t.init(e)},_initFlock:function(e){var t=new n.modules.FlockCard(n.twitterInterface);t.init(e,n.cardStorage,n._initPlayer)},_initCard:function(e){var t,o=e.card;if(n.twitterInterface=new n.modules.Interface,o&&(t=o.card_name))switch(t){case"__entity_animated_gif":case"__entity_video":case"amplify":case"animated_gif":case"audio":case"player":n._initPlayer();break;case"2485840682:flock":case"2485840682:flock_v2":n._initFlock(e.card.flock);break;case"2427656750:poll_choice2_m":case"2427656750:poll_choice2_r":case"2427656750:poll_choice4_m":case"2427656750:poll_choice4_r":case"2427656750:poll_choice4_rc":case"2427656750:poll_multi_m":case"2427656750:poll_multi_r":n._initPoll();break;case"poll2choice_text_only":n._initConsumerPoll(e);break;case"promotion":{new n.modules.FormHandler}}}};return n.init(),n}}),n("common/throttle",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(e,t){var n,o,r,a,i=0,c=function(){i=new Date,r=null,a=e.apply(n,o)};return function(){var s=new Date,l=t-(s-i);return n=this,o=arguments,0>=l?(clearTimeout(r),r=null,i=s,a=e.apply(n,o)):r||(r=setTimeout(c,l)),a}}}),n("../native/js/utils/text-ellipsis",["require","exports","module"],function(e,t,n){"use strict";n.exports=function(e){for(var t,n=document.querySelectorAll(e),o=100,r=0;t=n[r];r++){var a=t.offsetHeight+1;if(a>0&&t.scrollHeight>0)for(var i=t.textContent.split(""),c=0;o>c&&(t.scrollHeight>a&&i.length>3);c++)i.splice(i.length-3,3),t.textContent=i.join("")+"..."}}}),n("../native/js/interface",["require","exports","module","delegate","common/throttle","xdm","common/utils","./utils/text-ellipsis"],function(e,t,n){"use strict";var o=e("delegate"),r=e("common/throttle"),a=e("xdm"),i=(e("common/utils"),e("./utils/text-ellipsis"));n.exports=function(e){var t={defaultScribe:{DEFAULT_SCRIBE_ELEMENT:"platform_card"},scribeActionNames:{IMPRESSION:"impression",OPEN_LINK:"open_link",OPEN_PHOTO:"click",CARD_CLICK:"card_click",OPEN_AUTH_WEB_VIEW:"open_web_view_card"},selectors:{CARD_CLICK:".js-cardClick",CARD_CONTAINER:".TwitterCardsGrid.TwitterCard",CARD_ELLIPSIS:".tcu-textEllipse--multiline",CARD_SERIALIZATION:'script[type="text/twitter-cards-serialization"]',OPEN_COMMERCE_COLLECTION:".js-openCommerceCollection",OPEN_PRODUCT_PAGE_CARD:".js-openProductPageCard",COMPOSE_TWEET:".js-statusComposeTweet",OPEN_BUY_NOW_DIALOG:".js-openBuyNowDialog",OPEN_AUTH_WEB_VIEW:".js-openAuthWebView",OPEN_LEADGEN_CONFIRM_DIALOG:".js-openLeadGenConfirmDialog",OPEN_LINK:".js-openLink",OPEN_PHOTO:".js-openPhoto",OPEN_PROFILE:".js-openProfile",OPEN_GALLERY:".js-openGallery"},dataAttrs:{ACTION:"data-action",CARD_URL:"data-card-url",EARNED:"data-earned",IMPRESSION_ID:"data-impression-id",OPEN_LINK:"data-open-link",P_E_NAME:"data-pe-name",SCREEN_NAME:"data-screen-name",TWEET_TEXT:"data-tweet-text",USER_ID:"data-user-id"},config:null,host:null,hostMethods:null,throttleHandleResize:null,rpcHelpers:{ready:{onReady:function(){t.host.localMethodNames(function(e){t.hostMethods=e,t.handleOnReady(t.hostMethods)})}},methods:{local:{localMethodNames:function(){return{callVideoPlayerMethod:!0}},callVideoPlayerMethod:function(){t.callVideoPlayerMethod.apply(t,arguments)}},remote:{callMethodByName:{},followAdvertiser:{},localMethodNames:{},logPromotedInfo:{},openBuyNowDialog:{},openAuthWebView:{},openLeadGenConfirmDialog:{},openLinkNoScribe:{},openPhotoNoScribe:{},openProfile:{},resizeCard:{},scribe:{},statusComposeTweet:{},unfollowAdvertiser:{}}}},teardown:function(){window.removeEventListener("load",t.handleResize,!1),window.removeEventListener("resize",t.throttleHandleResize,!1),o(document).off("click",t.handleStatusComposeTweet),o(document).off("click",t.handleOpenBuyNowDialog),o(document).off("click",t.handleOpenAuthWebView),o(document).off("click",t.handleOpenLeadGenConfirmDialog),o(document).off("click",t.handleOpenLink),o(document).off("click",t.handleOpenPhoto),o(document).off("click",t.handleOpenProfile),o(document).off("click",t.handleCardClick),o(document).off("click",t.handleOpenCommerceCollection),o(document).off("click",t.handleOpenProductPageCard),t.host.destroy&&t.host.destroy()},handleOnReady:function(e){e&&(e.statusComposeTweet&&o(document).on("click",t.selectors.COMPOSE_TWEET,t.handleStatusComposeTweet),e.openBuyNowDialog&&o(document).on("click",t.selectors.OPEN_BUY_NOW_DIALOG,t.handleOpenBuyNowDialog),e.openAuthWebView&&o(document).on("click",t.selectors.OPEN_AUTH_WEB_VIEW,t.handleOpenAuthWebView),e.openLeadGenConfirmDialog&&o(document).on("click",t.selectors.OPEN_LEADGEN_CONFIRM_DIALOG,t.handleOpenLeadGenConfirmDialog),e.openLinkNoScribe&&o(document).on("click",t.selectors.OPEN_LINK,t.handleOpenLink),e.openPhotoNoScribe&&o(document).on("click",t.selectors.OPEN_PHOTO,t.handleOpenPhoto),e.openProfile&&o(document).on("click",t.selectors.OPEN_PROFILE,t.handleOpenProfile),e.scribe&&(o(document).on("click",t.selectors.OPEN_COMMERCE_COLLECTION,t.handleOpenCommerceCollection),o(document).on("click",t.selectors.OPEN_PRODUCT_PAGE_CARD,t.handleOpenProductPageCard),o(document).on("click",t.selectors.CARD_CLICK,t.handleCardClick)),e.resizeCard&&(t.handleResize(),window.addEventListener("load",t.handleResize,!1),window.addEventListener("resize",t.throttleHandleResize,!1)))},handlePromotedEngagement:function(e){t._logPromotedInfo(e,!0)},handleStatusComposeTweet:function(e){t._isSimpleClick(e)&&(t.host.statusComposeTweet({tweetText:e.delegateTarget.getAttribute(t.dataAttrs.TWEET_TEXT),scribeData:t.config.scribeData}),e.preventDefault())},handleOpenBuyNowDialog:function(e){t.host.openBuyNowDialog({tweetId:t.config.card.tweet_id,scribeData:t.config.scribeData}),t._logPromotedInfo(e,!1),t.handleScribe(e.delegateTarget.getAttribute(t.dataAttrs.ACTION)),e.stopPropagation(),e.preventDefault()},handleOpenAuthWebView:function(e){t.host.openAuthWebView({webviewUrl:t.config.card.webview_url}),t.handleScribe(t.scribeActionNames.OPEN_AUTH_WEB_VIEW,null,{description:t.config.card.webview_url}),e.stopPropagation(),e.preventDefault()},handleOpenCommerceCollection:function(e){t._openLink(e,!0);var n={collection_id:t.config.card.collection_id};t._getActionAndScribe(e.delegateTarget,n)},handleOpenProductPageCard:function(e){t._openLink(e,!0),t._getActionAndScribe(e.delegateTarget)},handleOpenLeadGenConfirmDialog:function(e){t.host.openLeadGenConfirmDialog({}),t.handleScribe(t.scribeActionNames.IMPRESSION),e.preventDefault()},handleOpenLink:function(e){var n=e.delegateTarget;t._openLink(e),t._getActionAndScribe(n)},handleOpenPhoto:function(e){var n,o,r,a={photos:[]};if(document.querySelector(t.selectors.OPEN_GALLERY))for(r=document.querySelectorAll(t.selectors.OPEN_PHOTO),n=0;o=r[n];n++)a.photos[n]={imageUrl:o.getAttribute("href"),wasClicked:o===e.delegateTarget};else a.photos.push({imageUrl:e.delegateTarget.getAttribute("href"),wasClicked:!0});a.scribeData=t.config.scribeData,t._isSimpleClick(e)&&(t.host.openPhotoNoScribe(a),t.handleScribe(t.scribeActionNames.OPEN_PHOTO),e.preventDefault())},handleOpenProfile:function(e){t._isSimpleClick(e)&&(t.host.openProfile({userId:e.delegateTarget.getAttribute(t.dataAttrs.USER_ID),userScreenName:e.delegateTarget.getAttribute(t.dataAttrs.SCREEN_NAME),scribeData:t.config.scribeData}),e.preventDefault())},handleCardClick:function(){t.handleScribe(t.scribeActionNames.CARD_CLICK)},handleResize:function(){var e=document.documentElement,n=document.querySelector(t.selectors.CARD_CONTAINER),o=560,r=n.offsetHeight,a=n.offsetWidth;"function"==typeof t.host.resizeCard&&t.host.resizeCard({height:r+"px"}),320>a&&""!==e.className?e.className="":a>=320&&o>a?e.className="mq-medium":a>=o&&(e.className="mq-medium mq-wide"),i(t.selectors.CARD_ELLIPSIS)},handleScribe:function(e,n,o){var r=n||t.defaultScribe.DEFAULT_SCRIBE_ELEMENT,e=e,a={customScribe:{element:r,action:e,itemData:o},scribeData:t.config.scribeData};this.host.scribe(a)},attachVideoInterface:function(e){t.videoInterface=e},callVideoPlayerMethod:function(){return t.videoInterface?t.videoInterface.callMethodByName.apply(t.videoInterface,arguments):null},callVideoHostMethod:function(){var e=arguments.length;return t.hostMethods&&t.hostMethods.callMethodByName?t.host.callMethodByName.apply(t.host,arguments):void(e>0&&arguments[e-1]())},composeTweet:function(e){t.host.statusComposeTweet(e)},_logPromotedInfo:function(e,n){var o=t._getPromotedEventName(e.delegateTarget);o&&t.host.logPromotedInfo({event:o,impressionId:t._getImpressionId(),earned:"true"===t._getEarned(),sync:n,scribeData:t.config.scribeData})},_getConfiguration:function(e){var t={},n=document.querySelector(e);if(n)try{t=window.CONFIG=JSON.parse(n.textContent||n.innerText)}catch(o){t.scribeData="error"}else t.scribeData="error";return t},_isSimpleClick:function(e){return!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||e.which>1)},_getPromotedEventName:function(e){return t._getClosestDataAttribute(e,t.dataAttrs.P_E_NAME)},_getImpressionId:function(){return document.querySelector(t.selectors.CARD_CONTAINER).getAttribute(t.dataAttrs.IMPRESSION_ID)},_getEarned:function(){var e=document.querySelector(t.selectors.CARD_CONTAINER).getAttribute(t.dataAttrs.EARNED);return e?e.toLowerCase():void 0},_getClosestDataAttribute:function(e,n){var o;return o=e&&"html"!==e.parentElement.nodeName.toLowerCase()?e.getAttribute(n)||t._getClosestDataAttribute(e.parentElement,n):!1},_openLink:function(e,n){var o=e.delegateTarget,r=t._getClosestDataAttribute(o,t.dataAttrs.OPEN_LINK);"a"!==o.nodeName.toLowerCase()&&r&&window.open(r,"_blank");var a={url:o.getAttribute("href"),scribeData:t.config.scribeData};n&&(a.skipEventUiCardUrlClick=n,t._logPromotedInfo(e,!1)),t.host.openLinkNoScribe(a)},_getActionAndScribe:function(e,n){var o=e.hasAttribute(t.dataAttrs.ACTION)?e.getAttribute(t.dataAttrs.ACTION):t.scribeActionNames.OPEN_LINK;t.handleScribe(o,void 0,n)}};t.config=t._getConfiguration(t.selectors.CARD_SERIALIZATION);try{t.host=e||new a.Rpc(t.rpcHelpers.ready,t.rpcHelpers.methods)}catch(n){}return t.throttleHandleResize=r(t.handleResize,75),t}}),e.config({baseUrl:"/lib/js",paths:{delegate:"../bower_components/delegate.js/delegate",matches:"../bower_components/matches.js/matches",xdm:"../bower_components/xdm.js/xdm"}}),t(["../native/js/initialize","../native/js/interface"],function(e,t){e(t)}),n("main-native",function(){})}();